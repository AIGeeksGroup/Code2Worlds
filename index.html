<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code2Worlds: Empowering Coding LLMs for 4D World Generation</title>
    <!-- <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒŒ</text></svg>"> -->
    <link rel="stylesheet" href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css">
    
    <style>
        @keyframes text-glow {
            0%, 100% {
                text-shadow: 0 0 10px #0ea5e9, 0 0 20px #0ea5e9, 0 0 30px #4f46e5, 0 0 40px #4f46e5;
            }
            50% {
                text-shadow: 0 0 5px #0ea5e9, 0 0 10px #0ea5e9, 0 0 15px #4f46e5, 0 0 20px #4f46e5;
            }
        }
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        * {
            font-family: Arial, sans-serif;
        }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(-45deg, #020617, #111827, #082f49, #4f46e5);
            background-size: 400% 400%;
            animation: gradient-animation 20s ease infinite;
            color: #9ca3af;
        }
        .group:hover .group-hover\:block {
            display: block !important;
            animation: fadeIn 0.2s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-bg {
            position: relative;
            overflow: hidden; 
        }
        .background-video {
            position: absolute; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; 
            z-index: -1;      
        }
        .hover-3d {
            transition: transform 0.3s ease;
        }
        .hover-3d:hover {
            transform: translateY(-5px) rotateX(5deg);
        }
        #point-cloud-container {
            width: 100%;
            height: 500px;
            background-color: #020617;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        #point-cloud-container canvas {
            display: block;
        }
        .video-selector.active {
            border: 2px solid #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.5);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -20px;
            margin-left: -20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body class="font-sans antialiased">
    
    <!-- <nav id="main-nav" class="fixed top-0 left-0 right-0 w-full z-50 transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <span class="text-2xl font-bold text-white" style="display: inline-block; color: transparent;
                    background-image: linear-gradient(120deg, #38bdf8, #818cf8, #c084fc);
                    -webkit-background-clip: text; background-clip: text;
                    text-shadow: 0 0 15px rgba(129, 140, 248, 0.5);">
                        &pi;Â³
                    </span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-6">
                        <a href="https://arxiv.org/abs/2507.13347" class="text-white/80 hover:text-white px-3 py-2">Paper</a>
                        <a href="https://github.com/yyfz/Pi3" class="text-white/80 hover:text-white px-3 py-2">GitHub</a>
                        <a href="https://huggingface.co/spaces/yyfz233/Pi3" class="text-white/80 hover:text-white px-3 py-2">Demo</a>
                        <div class="relative group">
                            <button class="text-white/80 hover:text-white px-3 py-2 focus:outline-none">
                                More Works
                                <svg class="w-4 h-4 inline-block ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </button>
                            <div class="absolute hidden group-hover:block pt-2 left-1/2 -translate-x-1/2 max-w-[calc(100vw-20px)]">
                                <div class="bg-white rounded-lg shadow-lg py-2 w-[max-content] min-w-[200px] max-w-full overflow-x-auto">
                                    <div class="px-2"> 
                                        <a href="https://sotamak1r.github.io/deepverse/" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 whitespace-nowrap">DeepVerse</a>
                                    </div>
                                    <div class="px-2"> 
                                        <a href="https://aether-world.github.io/" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 whitespace-nowrap">Aether</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav> -->
    
    <div class="gradient-bg min-h-screen flex items-center pt-20">
        <video autoplay loop muted playsinline class="background-video">
            <source src="assets/videos/teaser.mp4" type="video/mp4">
        </video>
    
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
            <div class="text-center">
                <p class="text-white mb-12 max-w-3xl mx-auto" style="font-family: Arial, sans-serif; font-size: 4em !important; font-weight: 900;
                    text-align: center; color: #f0e9e9 !important; animation: text-glow 4s ease-in-out infinite; margin-bottom: 0px;">
                    Code2Worlds
                </p>

                <p class="text-white mb-12 max-w-3xl mx-auto" style="font-family: Arial, sans-serif; font-size: 1.8em !important; font-weight: 900;
                    text-align: center; color: #f0e9e9 !important; animation: text-glow 4s ease-in-out infinite; margin-bottom: 0px;">
                    Empowering Coding LLMs for 4D World Generation
                </p>
    
                <div class="text-gray-800 mt-8 space-y-4">
                    <div class="text-white mb-12 max-w-3xl mx-auto" style="font-family: Arial, sans-serif; font-size: 2.em !important; font-weight: 900;
                    text-align: center; color: #fdffff !important; animation: text-glow 4s ease-in-out infinite; margin-bottom: 0px;">
                        <span>Yi Zhang<sup>*</sup></span>&nbsp;&nbsp;
                        <span>Yunshuang Wang<sup>*</sup></span>&nbsp;&nbsp;
                        <span><a href="https://steve-zeyu-zhang.github.io/">Zeyu Zhang</a><sup>*â€ </sup></span>&nbsp;&nbsp;
                        <span>Hao Tang<sup>â€¡</sup></span>
                    </div>
    
                    <div class="text-white mb-12 max-w-3xl mx-auto" style="font-family: Arial, sans-serif; font-size: 2.em !important; font-weight: 900;
                    text-align: center; color: #f0e9e9 !important; animation: text-glow 4s ease-in-out infinite; margin-bottom: 0px;">
                        <span>School of Computer Science, Peking University</span>
                    </div>
    
                    <div class="text-white mb-12 max-w-3xl mx-auto" style="font-family: Arial, sans-serif; font-size: 2.em !important; font-weight: 900;
                    text-align: center; color: #f0e9e9 !important; animation: text-glow 4s ease-in-out infinite; margin-bottom: 0px;">
                        <span><sup>*</sup>Equal contribution.</span>&nbsp;&nbsp;
                        <span><sup>â€ </sup>Project lead.</span>&nbsp;&nbsp;
                        <span><sup>â€ </sup>Corresponding author.</span>
                    </div>
    
                    <div class="flex justify-center items-center gap-x-6 pt-6">
                        <a href="https://arxiv.org/abs/2602.11757" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-6 py-3 font-semibold text-white bg-gradient-to-r from-green-500 to-cyan-500 rounded-xl shadow-lg transform transition-all duration-500 ease-in-out hover:scale-110 hover:shadow-2xl hover:from-green-600 hover:to-cyan-600">
                            ðŸ“„ Paper
                        </a>
                        <a href="https://github.com/AIGeeksGroup/Code2Worlds" target="_blank" rel="noopener noreferrer" 
                        class="flex items-center gap-2 px-6 py-3 font-semibold text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl shadow-lg transform transition-all duration-500 ease-in-out hover:scale-110 hover:shadow-2xl hover:from-blue-600 hover:to-purple-700">
                            ðŸ’» GitHub
                        </a>
                        <a href="https://huggingface.co/AIGeeksGroup/Code2Worlds" target="_blank" rel="noopener noreferrer" 
                        class="flex items-center gap-2 px-6 py-3 font-semibold text-white bg-gradient-to-r from-pink-500 to-yellow-500 rounded-xl shadow-lg transform transition-all duration-500 ease-in-out hover:scale-110 hover:shadow-2xl hover:from-pink-600 hover:to-yellow-600">
                            ðŸ¤— Model
                        </a>

                    </div>
                </div>
                </div>
        </div>
    </div>
</div>
    </div>
    
    <div class="py-24">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-16">
            <div class="mb-16 text-center">
                <h2 style="font-family: Arial, sans-serif; font-size: 2.4em !important; font-weight: 900;
                text-align: center; color: #f0e9e9 !important; animation: text-glow 4s ease-in-out infinite; margin-bottom: 0px;">
                    Visualization
                </h2>
            </div>

            <div class="text-center max-w-4xl mx-auto -mt-8 mb-16">
                <p class="text-lg text-gray-400" style="font-family: Arial, sans-serif;">
                    A curated gallery of Code2Worlds renders showcasing the geometry, lighting, and imagination that the model unlocks in every scene.
                </p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6" style="font-family: Arial, sans-serif;">
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene1.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A breeze stirs through the autumn forest, gently swaying the entire tree as leaves dance in the wind.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene2.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A 10-second time-lapse capturing the transition from warm pre-dawn to sunrise, followed by midday sunlight through a green canopy, golden late afternoon light, and ending with a moonlit, misty night.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene3.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">The midday sun illuminated tall trees as withered, yellowed leaves with brown spots fell silently, spinning before settling on a bright pile of fallen leaves.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene4.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A dense, lush green forest in a heavy rainstorm, with diagonal rain streaks and tall trees swaying gently in the wind and rain.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene5.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A peaceful desert afternoon with a gentle breeze, as sand flows like liquid silk down the sharp ridgeline of a dune.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene6.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A vibrant underwater scene with a translucent jellyfish glowing in soft blue and purple bioluminescence, its bell pulsating rhythmically as it drifts gracefully through the water.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene7.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A weathered chopped tree burns fiercely in the dark forest, with bright yellow flames rising from the center and glowing red embers on the edges. The flickering light casts dynamic shadows on the gnarled roots spreading into the dirt.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene8.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A tall, thick-walled ceramic cup with a wide, curved handle lies tipped on its side on the living room coffee table, spilling water from its wide rim and flooding the tabletop as it flows toward the edge and drips down.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene9.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A brown glass bottle rolled slowly across the sunlit living room floor.</p>
                </div>
                <div class="bg-white/5 rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <video autoplay controls loop muted playsinline class="w-full h-auto rounded-xl">
                        <source src="assets/videos/scene10.mp4" type="video/mp4">
                    </video>
                    <p class="mt-3 text-sm text-gray-300">A cozy bedroom with warm lighting, where a classic ceramic coffee cup sits on the desk, its smooth surface reflecting the soft glow as steam rises gently from the cup, disappearing into the light.</p>
                </div>
            </div>

    <div class="py-24">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-16">
            <div class="mb-16 text-center">
                <h2 style="font-family: Arial, sans-serif; font-size: 2.4em !important; font-weight: 900;
                text-align: center; color: #f0e9e9 !important; animation: text-glow 4s ease-in-out infinite; margin-bottom: 0px;">
                    Method
                </h2>
            </div>
        
            <div class="text-center max-w-4xl mx-auto -mt-8 mb-16">
                <p class="text-lg text-gray-400" style="font-family: Arial, sans-serif;">
                    We introduce Code2Worlds, a framework that formulates 4D generation as language-to-simulation code generation.
                </p>
            </div>
        
            <div class="py-24">
                <div class="max-w-7xl mx-auto"> 
                    <div class="flex justify-center"> 
                        <img src="assets/images/workflow_page-0001.jpg" alt="Model Pipeline" class="rounded-xl shadow-lg w-full max-w-7xl"> 
                    </div> 
                    <p class="text-center text-gray-300 mt-6 max-w-4xl mx-auto" style="font-family: Arial, sans-serif;">
                        Code2Worlds Execution Pipeline. The framework generates 4D scenes via a dual-stream architecture: 1) an Object Stream utilizing retrieval augmented parameter generation with object self-reflection; 2) a Scene Stream employing hierarchical environmental orchestration; and 3) a refinement mechanism driven by a PostProcess Agent and self-reflection.
                    </p>
                </div> 
            </div>

            <div class="py-24">
                <div class="max-w-7xl mx-auto"> 
                    <div class="flex justify-center"> 
                        <img src="assets/images/method_detail_page-0001.jpg" alt="Model Pipeline" class="rounded-xl shadow-lg w-full max-w-7xl"> 
                    </div> 
                    <p class="text-center text-gray-300 mt-6 max-w-4xl mx-auto" style="font-family: Arial, sans-serif;">
                        A detailed workflow for generating a 4D scene, integrating environmental scene, object generation, and feedback-driven refinement to ensure realistic scene rendering.
                    </p>
                </div> 
            </div>


        </div>
    </div>

    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
            }
        }
    </script>

    <footer class="py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-gray-200">
                Code2Worlds: Empowering Coding LLMs for 4D World Generation
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const videoRow = document.getElementById('video-row');
            const keyframeRow = document.getElementById('keyframe-row');
            const imageSelectionButtons = document.getElementById('image-selection-buttons');
            const imageDisplayContainer = document.getElementById('image-display-container');
            const mainImageDisplay = document.getElementById('main-image-display');
            const imageLoader = document.getElementById('image-loader');

            const videoData = {
                '1': {
                    keyframes: [
                        { 
                            img: './assets/images/depth_est.jpg', 
                            images: [
                                { path: './assets/images/depth_est.jpg',  text: 'VGGT' },
                                { path: './assets/images/depth_est.jpg',  text: 'Ours' },
                            ] 
                        },
                        { 
                            img: './assets/images/depth_est.jpg', 
                            images: [
                                { path: './assets/images/depth_est.jpg',  text: 'VGGT' },
                                { path: './assets/images/depth_est.jpg',  text: 'Ours' },
                            ] 
                        },
                        { 
                            img: './assets/images/depth_est.jpg', 
                            images: [
                                { path: './assets/images/depth_est.jpg',  text: 'VGGT' },
                                { path: './assets/images/depth_est.jpg',  text: 'Ours' },
                            ] 
                        },
                        { 
                            img: './assets/images/depth_est.jpg', 
                            images: [
                                { path: './assets/images/depth_est.jpg',  text: 'VGGT' },
                                { path: './assets/images/depth_est.jpg',  text: 'Ours' },
                            ]
                        }
                    ]
                },
                '2': {
                    keyframes: [
                        { 
                            img: './assets/images/depth_est.jpg', 
                            images: [
                                { path: './assets/images/depth_est.jpg',  text: 'VGGT' },
                                { path: './assets/images/depth_est.jpg',  text: 'Ours' },
                            ] 
                        },
                        { 
                            img: './assets/images/depth_est.jpg', 
                            images: [
                                { path: './assets/images/depth_est.jpg',  text: 'VGGT' },
                                { path: './assets/images/depth_est.jpg',  text: 'Ours' },
                            ]
                        }
                    ]
                },
                '3': {
                    keyframes: [
                        { 
                            img: './assets/images/depth_est.jpg', 
                            images: [
                                { path: './assets/images/depth_est.jpg',  text: 'VGGT' },
                                { path: './assets/images/depth_est.jpg',  text: 'Ours' },
                            ] 
                        },
                        { 
                            img: './assets/images/depth_est.jpg', 
                            images: [
                                { path: './assets/images/depth_est.jpg',  text: 'Image A' },
                                { path: './assets/images/depth_est.jpg',  text: 'Image B' },
                                { path: './assets/images/depth_est.jpg',  text: 'Image C' }
                            ]
                        }
                    ]
                }
            };

            function displayImage(imagePath) {
                imageLoader.style.display = 'none';
                mainImageDisplay.src = imagePath;
                mainImageDisplay.style.display = 'block';
            }

            videoRow.addEventListener('click', function(e) {
                const videoWrapper = e.target.closest('[data-video-id]');
                if (videoWrapper) {
                    const videoId = videoWrapper.dataset.videoId;
                    const data = videoData[videoId];
                    
                    keyframeRow.innerHTML = '';
                    imageSelectionButtons.innerHTML = '';
                    imageSelectionButtons.style.display = 'none';
                    imageDisplayContainer.style.display = 'none';

                    if (data && data.keyframes) {
                        data.keyframes.forEach(frame => {
                            const keyframeElement = document.createElement('div');
                            keyframeElement.className = 'cursor-pointer rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-shadow duration-300';
                            keyframeElement.innerHTML = `<img src="${frame.img}" alt="Keyframe" class="w-full h-auto">`;
                            
                            keyframeElement.addEventListener('click', () => {
                                imageDisplayContainer.style.display = 'block';
                                imageLoader.innerText = 'Please select an image version.';
                                imageLoader.style.display = 'block';
                                mainImageDisplay.style.display = 'none';

                                imageSelectionButtons.style.display = 'flex';
                                imageSelectionButtons.innerHTML = ''; 

                                if (frame.images) {
                                    frame.images.forEach((imageData) => {
                                        const button = document.createElement('button');
                                        button.className = 'px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500';
                                        
                                        button.innerText = imageData.text; 
                                        
                                        button.addEventListener('click', () => {
                                            displayImage(imageData.path); 
                                        });
                                        imageSelectionButtons.appendChild(button);
                                    });
                                }
                            });
                            keyframeRow.appendChild(keyframeElement);
                        });
                    }
                }
            });
        });
    </script>
    
    <script type="module">
        import * as THREE from 'three';
        // import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
        import { PLYLoader } from 'three/addons/loaders/PLYLoader.js'; // <-- Changed to PLYLoader
    
        // --- IMPORTANT: CUSTOMIZE YOUR VIDEO AND .PLY FILE PATHS HERE ---
        const pointCloudData = [
            {
                video: 'assets/videos/parkour.mp4',
                pcd: 'assets/pointclouds/parkour.ply'      // <-- Use .ply extension
            },
            {
                video: 'assets/videos/ship_man.mp4',
                pcd: 'assets/pointclouds/ship_man.ply'      // <-- Use .ply extension
            },
            {
                video: 'assets/videos/villa.mp4',
                pcd: 'assets/pointclouds/villa.ply'      // <-- Use .ply extension
            },
            {
                video: 'assets/videos/skating.mp4',
                pcd: 'assets/pointclouds/skating.ply'     // <-- Use .ply extension
            },
            {
                video: 'assets/videos/theatre.mp4',
                pcd: 'assets/pointclouds/theatre.ply'     // <-- Use .ply extension
            },
            {
                video: 'assets/videos/dog.mp4',
                pcd: 'assets/pointclouds/dog.ply'     // <-- Use .ply extension
            },
            {
                video: 'assets/videos/musk.mp4',
                pcd: 'assets/pointclouds/musk.ply'     // <-- Use .ply extension
            },
            {
                video: 'assets/videos/girl_running.mp4',
                pcd: 'assets/pointclouds/girl_running.ply'     // <-- Use .ply extension
            }
        ];
    
        let scene, camera, renderer, controls;
        let currentPoints = null;
    
        const container = document.getElementById('point-cloud-container');
        const loaderElement = document.getElementById('point-cloud-loader');
        const selectorsContainer = document.getElementById('point-cloud-selectors');
    
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x020617);
    
            camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, -5, 5);
            camera.up.set(0, 1, 0);
            scene.add(camera);
    
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
    
            controls = new TrackballControls(camera, renderer.domElement); 
    
            controls.rotateSpeed = 2.0;
            controls.zoomSpeed = 1.2;
            controls.panSpeed = 0.8;
            controls.noZoom = false;
            controls.noPan = false;
            controls.staticMoving = true;
            controls.dynamicDampingFactor = 0.3;
            
            controls.screenSpacePanning = true;
            controls.minDistance = 0.5;
            controls.maxDistance = 20;
            controls.target.set(0, 0, 0);
    
            window.addEventListener('resize', onWindowResize, false);
    
            populateSelectors();
            animate();
        }
    
        function populateSelectors() {
            pointCloudData.forEach((data, index) => {
                const selector = document.createElement('div');
                selector.className = 'video-selector cursor-pointer rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300';
                selector.dataset.pcdPath = data.pcd;
                selector.innerHTML = `<video muted playsinline loop class="w-full h-auto pointer-events-none"><source src="${data.video}" type="video/mp4"></video>`;
                
                selector.addEventListener('mouseenter', e => e.target.querySelector('video')?.play());
                selector.addEventListener('mouseleave', e => e.target.querySelector('video')?.pause());
    
                selector.addEventListener('click', () => {
                    //  ***** THE CHANGE IS HERE *****
                    controls.reset(); // Reset camera to initial position
                    //  ******************************
    
                    loadPointCloud(data.pcd);
                    document.querySelectorAll('.video-selector').forEach(el => el.classList.remove('active'));
                    selector.classList.add('active');
                });
                selectorsContainer.appendChild(selector);
            });
        }
    
        function loadPointCloud(path) {
            if (currentPoints) {
                scene.remove(currentPoints);
                currentPoints.geometry.dispose();
                currentPoints.material.dispose();
            }
            loaderElement.style.display = 'block';
    
            const loader = new PLYLoader();
            loader.load(path, 
                (geometry) => {
                    const material = new THREE.PointsMaterial({
                        size: 0.02,
                        vertexColors: true 
                    });
    
                    currentPoints = new THREE.Points(geometry, material);
    
                    currentPoints.geometry.center();
                    currentPoints.geometry.rotateX(-Math.PI / 2); 
                    
                    scene.add(currentPoints);
                    loaderElement.style.display = 'none';
                },
                (xhr) => {
                    // console.log((xhr.loaded / xhr.total * 100) + '% loaded');
                },
                (error) => {
                    console.error(`ERROR: Failed to load point cloud from '${path}'.\nCheck that the file path is correct and the file is not corrupted.\n`, error);
                    loaderElement.style.display = 'none';
                }
            );
        }
    
        function onWindowResize() {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
    
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
    
        init();
        
        if (pointCloudData.length > 0 && selectorsContainer.children.length > 0) {
            loadPointCloud(pointCloudData[0].pcd);
            selectorsContainer.children[0].classList.add('active');
        }
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const nav = document.getElementById('main-nav');
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 50) {
                    nav.classList.add('bg-white', 'shadow-md');
                    nav.querySelector('span').classList.replace('text-white', 'text-gray-900');
                    nav.querySelectorAll('a, button').forEach(link => {
                        link.classList.replace('text-white/80', 'text-gray-600');
                    });
                } else {
                    nav.classList.remove('bg-white', 'shadow-md');
                    nav.querySelector('span').classList.replace('text-gray-900', 'text-white');
                    nav.querySelectorAll('a, button').forEach(link => {
                        link.classList.replace('text-gray-600', 'text-white/80');
                    });
                }
            });
        });
    </script>
</body>
</html>
